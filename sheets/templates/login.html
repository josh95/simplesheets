{% extends "base.html" %}
{% block title %}Sheets{% endblock %}

{% block content %}
<h3>Login</h3>

<div class="container">
  <div class = "row">
		<input type="text" class="form-control" id = "user-txt" >
		<button class="btn btn-default" onclick= "checkUser()">Submit</button>
  </div>
</div>


<script>
	function getCookie(name) {
		var cookieValue = null;
		if (document.cookie && document.cookie !== '') {
			var cookies = document.cookie.split(';');
			for (var i = 0; i < cookies.length; i++) {
				var cookie = jQuery.trim(cookies[i]);
				// Does this cookie string begin with the name we want?
				if (cookie.substring(0, name.length + 1) === (name + '=')) {
					cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
					break;
				}
			}
		}
		return cookieValue;
	}
	function csrfSafeMethod(method) {
		// these HTTP methods do not require CSRF protection
		return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
	}
	$.ajaxSetup({
		beforeSend: function(xhr, settings) {
			if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
				xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
			}
		}
	});

	function checkUser(){
		var user = $("#user-txt").val();
		var pass = "poop";
		
		$.ajax({
		  method: "POST",
		  url: "checkUser/",
		  data: {'user': user, "pass":pass},
		  success: function(response) {
				post("sheetMain/", {"player_id": response, "csrfmiddlewaretoken":getCookie('csrftoken')}, "POST")
	      },
		  error: function(response) {
				alert("wrong user");
	      }
		});
	}
	
	function post(path, params, method) {
		method = method || "post"; // Set method to post by default if not specified.

		// The rest of this code assumes you are not using a library.
		// It can be made less wordy if you use one.
		var form = document.createElement("form");
		form.setAttribute("method", method);
		form.setAttribute("action", path);

		for(var key in params) {
			if(params.hasOwnProperty(key)) {
				var hiddenField = document.createElement("input");
				hiddenField.setAttribute("type", "hidden");
				hiddenField.setAttribute("name", key);
				hiddenField.setAttribute("value", params[key]);

				form.appendChild(hiddenField);
			}
		}

		document.body.appendChild(form);
		form.submit();
	}
</script>
{% endblock %}